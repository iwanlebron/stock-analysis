## 目标与产出
- 输入：股票代码（支持美股 ticker，或扩展到 A 股代码）、时间区间、频率（日线/小时线）。
- 输出：0–100 的“贪婪恐怖分数”、分档标签（极度恐惧/恐惧/中性/贪婪/极度贪婪）、以及贡献度拆解（每个子指标对总分的影响）。
- 展示：交互式图表（价格+分数+子指标）、可导出的 JSON/CSV 报告。

## 数据与技术选型（可插拔）
- 数据提供层设计为可插拔 Provider：统一输出 OHLCV（开高低收量）与可选增强数据（如期权隐含波动率、换手率）。
- 默认实现（从易到难）：
  1) Yahoo Finance（美股/部分全球市场）：实现快、无需密钥。
  2) A 股：优先 AkShare；若你有 TuShare Token，则再加 TuShare Provider。
- 加缓存：本地文件缓存（按 ticker+区间+频率）避免重复拉取。

## 指标体系（针对“单只股票”合理化）
将“贪婪恐怖”拆成 5–8 个可解释的子因子，每个因子映射到 0–100：
- 趋势/动量（Greed）：
  - 价格相对均线距离：Close vs MA20/MA60（越强越贪婪）。
  - 12-1 动量或 20 日收益率（越高越贪婪）。
- 超买超卖（两面）：
  - RSI(14)：高 RSI 更偏贪婪，低 RSI 更偏恐惧。
  - MACD 柱状图/信号差：正向更贪婪。
- 波动与压力（Fear）：
  - 实现波动率（rolling std of returns）或 ATR%（越高越恐惧）。
  - 回撤压力：距离 52 周高点的跌幅、近期最大回撤（越大越恐惧）。
- 成交与情绪代理（视数据可用性）：
  - 量能异常：Volume 相对 20 日均量的倍数（放量上涨偏贪婪，放量下跌偏恐惧）。
  - 可选：期权 Put/Call、IV Rank（如拿得到则加入权重，否则跳过）。

## 评分与归一化方法（核心）
- 每个子指标先转换成“越大越贪婪”的方向（或取负号）。
- 采用稳健归一化：滚动窗口分位数（例如近 252 交易日）→ 映射到 0–100，避免不同股票尺度差异。
- 总分 = 各子指标分数的加权平均（默认权重可配置），并输出：
  - 当前值、历史分布分位、贡献度（weight × subscore）。
- 分档规则（可调）：
  - 0–24 极度恐惧；25–44 恐惧；45–55 中性；56–75 贪婪；76–100 极度贪婪。

## 项目结构（从零搭建时的推荐边界）
- `providers/`：数据拉取与标准化（OHLCV schema）。
- `indicators/`：技术指标计算（纯 pandas/numpy，避免系统级依赖）。
- `scoring/`：归一化、权重、分档、贡献度。
- `reporting/`：图表与导出（Plotly/Matplotlib 二选一）。
- `api/`（可选）：FastAPI 提供 `/fear-greed?ticker=...`。
- `ui/`（可选）：Streamlit 仪表盘。

## 验证与质量保障
- 单元测试：
  - 指标计算的基本性质（RSI 范围 0–100、归一化输出在 0–100）。
  - 评分方向性（例如价格更强时趋势分数不下降）。
- 冒烟测试：选 1–2 个 ticker 拉取数据→生成分数→导出报告。
- 性能：缓存命中 + 向量化计算；必要时加并行拉取。

## 里程碑交付（实现顺序）
1) 先做可运行的“核心库”：Provider + 子指标 + 评分 + JSON 输出。
2) 再加可视化：单页图表（价格+总分+子指标）。
3) 再加服务化：API 或 Streamlit UI（二选一或都做）。

## 我需要你默认接受的假设（便于直接开工）
- 先以“日线 OHLCV”作为主数据源；先做美股 Yahoo Provider，A 股 Provider 作为第二阶段。
- 初版不强依赖期权数据（有则加，无则跳过）。

确认后我会开始落地：初始化项目结构、实现 Yahoo/AkShare Provider（按你的市场选择）、实现子指标与分数、补齐测试与一个可运行的 demo。